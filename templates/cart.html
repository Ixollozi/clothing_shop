{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Shopping Cart" %} - {{ store_name }}{% endblock %}

{% block content %}
    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>{% trans "Shopping Cart" %}</h1>
            <nav class="breadcrumbs">
                <a href="{% url 'index' %}">{% trans "Home" %}</a> / <span>{% trans "Shopping Cart" %}</span>
            </nav>
        </div>
    </section>

    <!-- Cart Content -->
    <section class="cart-section">
        <div class="container">
            <div class="cart-layout">
                <!-- Cart Items -->
                <div class="cart-items">
                    <div class="cart-item">
                        <div class="cart-item-image">
                            <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=200" alt="{% trans 'Classic T-shirt' %}">
                        </div>
                        <div class="cart-item-info">
                            <h3>{% trans "Classic T-shirt" %}</h3>
                            <p class="cart-item-details">{% trans "Size" %}: M, {% trans "Color" %}: {% trans "Black" %}</p>
                            <p class="cart-item-price">20 $</p>
                        </div>
                        <div class="cart-item-quantity">
                            <button class="qty-btn" onclick="updateQuantity(this, -1)">-</button>
                            <input type="number" value="2" min="1" class="qty-input">
                            <button class="qty-btn" onclick="updateQuantity(this, 1)">+</button>
                        </div>
                        <div class="cart-item-total">
                            <span class="item-total-price">40 $</span>
                        </div>
                        <button class="cart-item-remove" onclick="removeItem(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="cart-item">
                        <div class="cart-item-image">
                            <img src="https://images.unsplash.com/photo-1551028719-00167b16eac5?w=200" alt="{% trans 'Jeans' %}">
                        </div>
                        <div class="cart-item-info">
                            <h3>{% trans "Classic Jeans" %}</h3>
                            <p class="cart-item-details">{% trans "Size" %}: L, {% trans "Color" %}: {% trans "Blue" %}</p>
                            <p class="cart-item-price">35 $</p>
                        </div>
                        <div class="cart-item-quantity">
                            <button class="qty-btn" onclick="updateQuantity(this, -1)">-</button>
                            <input type="number" value="1" min="1" class="qty-input">
                            <button class="qty-btn" onclick="updateQuantity(this, 1)">+</button>
                        </div>
                        <div class="cart-item-total">
                            <span class="item-total-price">35 $</span>
                        </div>
                        <button class="cart-item-remove" onclick="removeItem(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="cart-item">
                        <div class="cart-item-image">
                            <img src="https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=200" alt="{% trans 'Shirt' %}">
                        </div>
                        <div class="cart-item-info">
                            <h3>{% trans "Office Shirt" %}</h3>
                            <p class="cart-item-details">{% trans "Size" %}: M, {% trans "Color" %}: {% trans "White" %}</p>
                            <p class="cart-item-price">25 $</p>
                        </div>
                        <div class="cart-item-quantity">
                            <button class="qty-btn" onclick="updateQuantity(this, -1)">-</button>
                            <input type="number" value="1" min="1" class="qty-input">
                            <button class="qty-btn" onclick="updateQuantity(this, 1)">+</button>
                        </div>
                        <div class="cart-item-total">
                            <span class="item-total-price">25 $</span>
                        </div>
                        <button class="cart-item-remove" onclick="removeItem(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Cart Summary -->
                <div class="cart-summary">
                    <h2>{% trans "Total" %}</h2>
                    <div class="summary-row">
                        <span>{% trans "Products" %} (4 {% trans "pcs" %}.)</span>
                        <span id="subtotal">100 $</span>
                    </div>
                    <div class="summary-row">
                        <span>{% trans "Delivery" %}</span>
                        <span id="delivery">{% trans "Free" %}</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>{% trans "To pay" %}</span>
                        <span id="total">100 $</span>
                    </div>
                    <button class="btn btn-primary btn-large" style="width: 100%; margin-top: 1rem;">
                        {% trans "Place Order" %}
                    </button>
                    <a href="{% url 'catalog' %}" class="continue-shopping">
                        <i class="fas fa-arrow-left"></i> {% trans "Continue Shopping" %}
                    </a>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block extra_js %}
<script>
    function updateQuantity(btn, change) {
        const qtyInput = btn.parentElement.querySelector('.qty-input');
        const currentValue = parseInt(qtyInput.value);
        const newValue = Math.max(1, currentValue + change);
        qtyInput.value = newValue;
        updateItemTotal(btn.closest('.cart-item'));
        updateCartTotal();
    }

    function updateItemTotal(item) {
        const price = parseFloat(item.querySelector('.cart-item-price').textContent.replace(/\s/g, '').replace('$', ''));
        const quantity = parseInt(item.querySelector('.qty-input').value);
        const total = price * quantity;
        item.querySelector('.item-total-price').textContent = total.toLocaleString() + ' $';
    }

    function removeItem(btn) {
        if (confirm('{% trans "Remove item from cart?" %}')) {
            btn.closest('.cart-item').remove();
            updateCartTotal();
        }
    }

    function updateCartTotal() {
        const items = document.querySelectorAll('.cart-item');
        let subtotal = 0;
        items.forEach(item => {
            const totalText = item.querySelector('.item-total-price').textContent;
            subtotal += parseFloat(totalText.replace(/\s/g, '').replace('$', ''));
        });
        
        document.getElementById('subtotal').textContent = subtotal.toLocaleString() + ' $';
        document.getElementById('total').textContent = subtotal.toLocaleString() + ' $';
    }
</script>
{% endblock %}
